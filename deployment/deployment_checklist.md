atlas 集群企业网部署总结暨检查清单
===========================================================================

集群基本信息和环境预置
---------------------------------------------------------------------------

1. 集群规划
   
   * 节点硬件架构 
   - 示例： GPU 主机，CPU主机，NPU主机

   * 设备数量
   - 示例：单机，同构多机，异构多机

   * 关键资源配置（NPU,GPU，网卡）
   - 路由器配置，需支持DNS Maping, DHCP Server，IP-MAC-Band
   - 交换机配置, 100G, 10G, 流控，自适应
   - 每个节点（node）资源配置：芯片数量
   - 每个节点依赖资源：
      + 网卡：驱动版本，支持接口数
      + 网络接口：名称，IP配置

2. 操作系统、驱动和组件版本
   * 主机操作系统：Ubuntu 18.04.1
   * Docker 版本：19.03.12, build 48a6621
   * k8s 版本：v1.18.0
   * Mysql Server: 8.0.20 (mysql Ver 14.14 Distrib 5.7.30)
   * 容器系统和版本：Ubuntu 18.04
   * Python 3.7.5
   * 芯片驱动：
      - Nvidia GPU：xxxxxx
      - Huawei NPU: C73B035
   * 网卡驱动：TM210网卡驱动 v1.0.1

网络规划和组网
---------------------------------------------------------------------------

1. 组网规划
   **master和worker需在同一个局域网或VPC**
   | 主机名       | 公网IP        | mask        | gateway       |DNS            |iBMC公网IP     |私网IP         |
   |:----------- |:--------------|:------------|:--------------|:--------------|:--------------|:--------------|
   | atlas01     |xxx.xxx.xxx.xxx|255.255.255.0|xxx.xxx.xxx.xxx|114.114.114.114|xxx.xxx.xxx.xxx|xxx.xxx.xxx.xxx|
   | atlas02     |xxx.xxx.xxx.xxx|255.255.255.0|xxx.xxx.xxx.xxx|114.114.114.114|xxx.xxx.xxx.xxx|xxx.xxx.xxx.xxx|
   | atlas03     |xxx.xxx.xxx.xxx|255.255.255.0|xxx.xxx.xxx.xxx|114.114.114.114|xxx.xxx.xxx.xxx|xxx.xxx.xxx.xxx|

   **3 台 atlas 的 NPU 组网规划：**

   | node    | npu_id | address       | netmask       |
   |---------|--------|---------------|---------------|
   | atlas01 | NPU0   | 192.168.10.11 | 255.255.255.0 |
   | atlas01 | NPU1   | 192.168.20.11 | 255.255.255.0 |
   | atlas01 | NPU2   | 192.168.30.11 | 255.255.255.0 |
   | atlas01 | NPU3   | 192.168.40.11 | 255.255.255.0 |
   | atlas01 | NPU4   | 192.168.10.12 | 255.255.255.0 |
   | atlas01 | NPU5   | 192.168.20.12 | 255.255.255.0 |
   | atlas01 | NPU6   | 192.168.30.12 | 255.255.255.0 |
   | atlas01 | NPU7   | 192.168.40.12 | 255.255.255.0 |
   | atlas02 | NPU0   | 192.168.10.21 | 255.255.255.0 |
   | atlas02 | NPU1   | 192.168.20.21 | 255.255.255.0 |
   | atlas02 | NPU2   | 192.168.30.21 | 255.255.255.0 |
   | atlas02 | NPU3   | 192.168.40.21 | 255.255.255.0 |
   | atlas02 | NPU4   | 192.168.10.22 | 255.255.255.0 |
   | atlas02 | NPU5   | 192.168.20.22 | 255.255.255.0 |
   | atlas02 | NPU6   | 192.168.30.22 | 255.255.255.0 |
   | atlas02 | NPU7   | 192.168.40.22 | 255.255.255.0 |
   | atlas03 | NPU0   | 192.168.10.31 | 255.255.255.0 |
   | atlas03 | NPU1   | 192.168.20.31 | 255.255.255.0 |
   | atlas03 | NPU2   | 192.168.30.31 | 255.255.255.0 |
   | atlas03 | NPU3   | 192.168.40.31 | 255.255.255.0 |
   | atlas03 | NPU4   | 192.168.10.32 | 255.255.255.0 |
   | atlas03 | NPU5   | 192.168.20.32 | 255.255.255.0 |
   | atlas03 | NPU6   | 192.168.30.32 | 255.255.255.0 |
   | atlas03 | NPU7   | 192.168.40.32 | 255.255.255.0 |

2. 网络拓扑

   ![image](satic/atlas集群拓扑图.png)

3. 基础网络配置，参考部署文档

   * 各节点机器主机名（hostname）
   * 资源节点（GPU,NPU,CPU,TPU）接入交换机局域网配置，流控配置
   * 节点接入交换机局域网配置
   * 本地域名解析配置
   * 公网域名解析配置
   * 路由网关或接入网关的DHCP Server，IP-MAC绑定配置
   * 路由网关或接入网关的DNS Local Maping配置

5. 集群状态检查

   * 平台外网访问状态
   * 集群节点状态
   * k8s 集群状态
   * k8s 节点状态
   * 平台组件pod状态
   * 关键组件（NPU,GPU）状态
   * 节点资源空闲状态
   * 存储使用率
   * 主要业务流 (VC->vc Status->Submit Job->Job List->Job Status->Job Debug)

