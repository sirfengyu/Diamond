## 配置说明

#### atlas集群

| 主机名              | hostname    |配置   | GPU  | 操作系统       | 内网IP1      | 内网IP2（集群内通信）  | 登陆指令                      | 角色    |
|--------------------|-------------|-------| -----| --------------|--------------|----------------------|-------------------------------|--------|
| atlas-master       | atlas01     | N/A   | 8    | ubuntu 18.04  | 192.168.1.23 | 192.168.2.15         | ssh root@121.46.18.83 -p 50026| worker  |
| altas-worker01-npu | atlas01     |N/A    | 8    | ubuntu 18.04  | NA           | 192.168.2.14         | ssh root@121.46.18.83 -p 50027| master  |
| atlas-worker02-gpu | atlas-gpu01 |36C512G| 8    | ubuntu 18.04  | 192.168.1.8  | 192.168.2.11         | ssh root@121.46.18.83 -p 50023| worker  |
| atlas-worker03-gpu | atlas-gpu02 |36C512G| 8    | ubuntu 18.04  | 192.168.1.9  | 192.168.2.10         | ssh root@121.46.18.83 -p 50024| worker  |
| CPU server02       | N/A         |N/A    | N/A  | ubuntu 18.04  | 192.168.1.18 | 192.168.2.7          | ssh root@121.46.18.83 -p 50028|未使用    |
| Ceph Monitor       | N/A         |N/A    | N/A  | ubuntu 18.04  | 192.168.1.29 | 192.168.2.16         | ssh root@121.46.18.83 -p 50029|storage  |
| Ceph Metadata      | N/A         |N/A    | N/A  | ubuntu 18.04  | 192.168.1.24 | 192.168.2.18         | ssh root@121.46.18.83 -p 50030|storage  |
| Ceph OSD 01        | N/A         |N/A    | N/A  | ubuntu 18.04  | 192.168.1.30 | 192.168.2.17         | ssh root@121.46.18.83 -p 50031|storage  |
| Ceph OSD 02        | N/A         |N/A    | N/A  | ubuntu 18.04  | 192.168.1.31 | 192.168.2.13         | ssh root@121.46.18.83 -p 50032|storage  |

#### china-gpu集群

| 主机名             | 配置    | GPU   | 操作系统      | LAN1         | LAN2         | 登陆指令                       | 角色   |
| ------------------| ------- |-------| ------------ | ------------ | ------------ |--------------------------------| ------ |
| china-gpu-master  | N/A     | 6C64G | ubuntu 18.04 | 192.168.1.3  |              | ssh root@121.46.18.83 -p 50022 | master |
| china-gpu-worker01| N/A     | 8     | ubuntu 18.04 | 192.168.1.11 | 192.168.2.8  | ssh root@121.46.18.83 -p 50025 | worker |
| storage-server    | 16C187G | N/A   | freenas      | 192.168.1.10 | 192.168.2.12 | ssh root@121.46.18.83 -p 50021 | worker |

备注：目前外网登录大部分通过1g switcherd的1网段进行外网映射以通信，集群内通信请使用10g的2网段（所有机器都有2网段，除cpu01外）

## IPMI管理页面

| 节点                | URL                                                       | 子网IP        |
|---------------------|-----------------------------------------------------------|--------------|
| china-gpu-master    | https://121.46.18.83:51022/                               | 192.168.1.16 |
| china-gpu-worker01  | [https://121.46.18.83:51025](https://121.46.18.83:51025/) | 192.168.1.20 |
| storage-server      | https://121.46.18.83:51021/                               | 192.168.1.2  |
| altas-master        | [https://121.46.18.83:51026](https://121.46.18.83:51026/) | 192.168.1.15 |
| altas-worker01-npu  | [https://121.46.18.83:51027](https://121.46.18.83:51027/) | 192.168.1.21 |
| atlas-worker02-gpu  | https://121.46.18.83:51023/                               | 192.168.1.6  |
| atlas-worker03-gpu  | https://121.46.18.83:51024/                               | 192.168.1.5  |
| CPU server02        | [https://121.46.18.83:51028](https://121.46.18.83:51028/) | 192.168.1.17 |
| Ceph Monitor        | [https://121.46.18.83:51029](https://121.46.18.83:51029/) | 192.168.1.19 |
| Ceph Metadata       | [https://121.46.18.83:51030](https://121.46.18.83:51030/) | 192.168.1.25 |
| Ceph OSD 01         | [https://121.46.18.83:51031](https://121.46.18.83:51031/) | 192.168.1.26 |
| Ceph OSD 02         | [https://121.46.18.83:51032](https://121.46.18.83:51032/) | 192.168.1.27 |

## TPLink路由器配置(IP:121.46.18.84)

http://121.46.18.84:50444/


## USG Pro Gateway配置(IP:121.46.18.83)

https://apulis-gpu01.sigsus.com:8443/


## DLTS平台配置

https://github.com/apulis/dev_document/blob/master/DLWS/deployment/cluster_config/china_gpu02/china_gpu02_2020_0423.tar.gz

## IB交换机配置

| 节点                |  子网IP     |
| --------------------| ---------- |
| china-gpu-master    | 10.200.0.1 |
| china-gpu-worker1   | 10.200.0.2 |
| china-gpu-worker2   | 10.200.0.3 |
| storage-server      | 10.200.0.4 |
| china-gpu01         | 10.200.0.5 |

#### 启动IB服务

> service openibd start  
> systemctl enable openibd.service  
> service opensmd start  
> systemctl enable opensmd.service  

#### 配置IB地址

> 以master为例：
>
> 执行：ibstat，获取启动的ib卡接口名称，此处假设为ib0
>
> 执行：ifconfig  ib0 10.200.0.1/24

## 密码信息

OneDrive路径：

Apulis Technology Inc\Kelly Zhang - Apulis File Share\研发部\运维部

## DLTS转发配置

| 路由器端口               | 服务端口  |
| ------------------- | :-------------------------- |
| 80 | 80|
| 443 | 443 |
| 30000 ~ 49999 | 30000 ~ 49999 |

## 网络拓扑结构

<img src="topology.jpg"/>
